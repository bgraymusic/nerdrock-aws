// BANDCAMP API
///////////////////////////////////////////////////////////////////////////////////////////////////
// ARTIST INFO
// http://api.bandcamp.com/api/band/3/info?key=throtaudvinroftignmarkreina&band_id=230945364&debug
//{
//  "url": "http://briangray.bandcamp.com",
//  "name": "Brian Gray",
//  "band_id": 230945364,
//  "offsite_url": null,
//  "subdomain": "briangray"
//}
//
// DISCOGRAPHY
// http://api.bandcamp.com/api/band/3/discography?key=throtaudvinroftignmarkreina&band_id=230945364&debug
//{
//  "discography": [
//    {
//      "downloadable": 2,
//      "art_id": 2981166972,
//      "title": "Every Song in the Universe",
//      "url": "http://briangray.bandcamp.com/album/every-song-in-the-universe?pk=604",
//      "artist": "Brian Gray",
//      "small_art_url": "http://f1.bcbits.com/img/a2981166972_3.jpg",
//      "band_id": 230945364,
//      "release_date": 1359504000,
//      "large_art_url": "http://f1.bcbits.com/img/a2981166972_2.jpg",
//      "album_id": 3541981135
//    }
//  ]
//}
//
// ALBUM
// http://api.bandcamp.com/api/album/2/info?key=throtaudvinroftignmarkreina&album_id=3541981135&debug
//{
//  "downloadable": 2,
//  "about": "Don't let the title fool you. What I mean by \"Every Song\" is more like \"Every song I've gotten around to bouncing in AIF and placed on BandCamp\". To see my full discography (maybe like 30 songs?) before I'm finished, please visit my main site at https://sites.google.com/site/briangraymusic/",
//  "tracks": [
//    {
//      "downloadable": 2,
//      "track_id": 2923511621,
//      "duration": 205.044,
//      "number": 1,
//      "title": "Ï€ Day",
//      "url": "/track/day?pk=604",
//      "lyrics": "[Verse 1]\r\nI wake up early in a transcendental scene.\r\nI'm all crazily irrational, 'cause it's March fourteen.\r\nWe've got no need for decimals that terminate or repeat,\r\nAnd everybody knows the Feynman point is the place to meet.\r\nIt's where we'll have a\r\n\r\n[Chorus]\r\nHappy, happy Ï€ Day! I'm all geeked out, and I'm feeling fine\r\nOn this happy, happy Ï€ Day. I've got 3.141592653589793238\r\nReasons this happy, happy Ï€ Day is gonna be great!\r\n\r\n[Verse 2]\r\nWe'll eat pie. It's a homonym, you see.\r\nOk, well that's not exactly right, because technically,\r\nTrue homonyms are spelled alike, a trait these don't possess.\r\nThe word you're looking for is \"homophone\", but I digress.\r\nIt's gonna be a\r\n\r\n[Chorus]\r\n\r\n[Bridge]\r\nWithout Ï€, we wouldn't ever know the circumference of a circle.\r\nWithout Ï€, we can't find the area of that same circle.\r\nWithout Ï€, how would we ever guess the volume of a sphere.\r\nWithout pie, there would be no good use for blueberries.\r\n\r\n[Verse 3]\r\nAs far as we can tell, it all starts with pyramids,\r\nThen Archimedes and Ptolemy worked it out to amuse the kids.\r\nMadhava rocked the Calculus, and Machin's trig was phat,\r\nBut hey, we've all got computers now, so to hell with that.\r\nI say we have a\r\n\r\n[Chorus]",
//      "streaming_url": "http://popplers5.bandcamp.com/download/track?enc=mp3-128&fsig=41b27baead555e8f5d6491e4a16f1964&id=2923511621&stream=1&ts=1419900326.0",
//      "band_id": 230945364,
//      "album_id": 3541981135
//    },
//	.
//	.
//	.
//  ],
//  "title": "Every Song in the Universe",
//  "url": "http://briangray.bandcamp.com/album/every-song-in-the-universe?pk=604",
//  "small_art_url": "http://f1.bcbits.com/img/a2981166972_3.jpg",
//  "band_id": 230945364,
//  "release_date": 1359504000,
//  "large_art_url": "http://f1.bcbits.com/img/a2981166972_2.jpg",
//  "album_id": 3541981135
//}
//
// TRACK
// http://api.bandcamp.com/api/track/3/info?key=throtaudvinroftignmarkreina&track_id=2923511621&debug
//{
//  "downloadable": 2,
//  "about": null,
//  "credits": null,
//  "track_id": 2923511621,
//  "duration": 205.044,
//  "number": 1,
//  "title": "Ï€ Day",
//  "url": "/track/day",
//  "lyrics": "[Verse 1]\r\nI wake up early in a transcendental scene.\r\nI'm all crazily irrational, 'cause it's March fourteen.\r\nWe've got no need for decimals that terminate or repeat,\r\nAnd everybody knows the Feynman point is the place to meet.\r\nIt's where we'll have a\r\n\r\n[Chorus]\r\nHappy, happy Ï€ Day! I'm all geeked out, and I'm feeling fine\r\nOn this happy, happy Ï€ Day. I've got 3.141592653589793238\r\nReasons this happy, happy Ï€ Day is gonna be great!\r\n\r\n[Verse 2]\r\nWe'll eat pie. It's a homonym, you see.\r\nOk, well that's not exactly right, because technically,\r\nTrue homonyms are spelled alike, a trait these don't possess.\r\nThe word you're looking for is \"homophone\", but I digress.\r\nIt's gonna be a\r\n\r\n[Chorus]\r\n\r\n[Bridge]\r\nWithout Ï€, we wouldn't ever know the circumference of a circle.\r\nWithout Ï€, we can't find the area of that same circle.\r\nWithout Ï€, how would we ever guess the volume of a sphere.\r\nWithout pie, there would be no good use for blueberries.\r\n\r\n[Verse 3]\r\nAs far as we can tell, it all starts with pyramids,\r\nThen Archimedes and Ptolemy worked it out to amuse the kids.\r\nMadhava rocked the Calculus, and Machin's trig was phat,\r\nBut hey, we've all got computers now, so to hell with that.\r\nI say we have a\r\n\r\n[Chorus]",
//  "small_art_url": null,
//  "streaming_url": "http://popplers5.bandcamp.com/download/track?enc=mp3-128&fsig=563b18375a7f71a46a7fb1834ff1bc03&id=2923511621&stream=1&ts=1419900469.0",
//  "band_id": 230945364,
//  "large_art_url": null,
//  "album_id": 3541981135
//}
///////////////////////////////////////////////////////////////////////////////////////////////////
function Bandcamp() {
	return this;
}

//Bandcamp.apiURL = 'http://api.bandcamp.com';
Bandcamp.URL = 'http://briangray.bandcamp.com';
Bandcamp.apiURL = '/bcapi';
Bandcamp.apiKey = 'throtaudvinroftignmarkreina';
//Bandcamp.bandId = '230945364'; // probably permanent
Bandcamp.bandInfoApi = '/api/band/3/info';
Bandcamp.discographyApi = '/api/band/3/discography';
Bandcamp.albumInfoApi = '/api/album/2/info';
Bandcamp.trackInfoApi = '/api/track/3/info';
Bandcamp.discography = {};

Bandcamp.prototype = {
	getBandcampData: function(cb, bandId) {
		var bcObj = this;
		jQuery.ajaxSetup({async:false});
		var discography = {};
		var foo = $.getJSON(Bandcamp.apiURL + Bandcamp.discographyApi, {
			key: Bandcamp.apiKey, band_id: bandId
		}, function(discData) {
			discography = discData.discography;
			for (var albumIdx in discography) {
				var album = discography[albumIdx];
				bcObj.getAlbum(album);
			}
		});
		cb(discography);
		return (!!Bandcamp.netError);
	},

	getAlbum: function(album) {
		$.getJSON(Bandcamp.apiURL + Bandcamp.albumInfoApi, {
			key: Bandcamp.apiKey, album_id: album.album_id
		}, function(albumData) {
			$.extend(album, albumData);
		});
	}
}
